;-------------------------------------------------
;「特殊技術を調査する」
;-------------------------------------------------
@Colonial_Office_university_RESEARCH_SP_TECH
#DIM 外来人
#DIM 触手
#DIM 選択対象
#DIM 連邦ナンバー
#DIM 外交対象
#DIM 連邦構成国, MAX_COUNTRY

;連邦ナンバーを検索
FOR LOCAL:0, 0, MAX_COUNTRY
	FOR LOCAL:1, 0, MAX_COUNTRY
		IF TREATY_UNI_COUNTRY:(LOCAL:0):(LOCAL:1):0 == CFLAG:MASTER:所属 || TREATY_UNI_COUNTRY:(LOCAL:0):(LOCAL:1):1 == CFLAG:MASTER:所属
			連邦ナンバー = LOCAL:0
			BREAK
		ENDIF
	NEXT
NEXT
;連邦構成国を検索
FOR LOCAL:0, 0, MAX_COUNTRY
	IF TREATY_UNI_COUNTRY:連邦ナンバー:(LOCAL:0):0 > 0
		連邦構成国:(TREATY_UNI_COUNTRY:連邦ナンバー:(LOCAL:0):0) = 1
	ELSEIF TREATY_UNI_COUNTRY:連邦ナンバー:(LOCAL:0):1 > 0
		連邦構成国:(TREATY_UNI_COUNTRY:連邦ナンバー:(LOCAL:0):1) = 1
	ENDIF
NEXT

外来人 = GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:特殊勢力_外来人)
触手 = GET_COUNTRY_FROM_ID(SP_COUNTRY_ID:特殊勢力_触手)

FOR LOCAL:0, 0, MAX_COUNTRY
	IF IS_SP_COUNTRY(LOCAL:0) && LOCAL:0 > 0 && LOCAL:0 == 触手
		外交対象 = LOCAL:0
		BREAK
	ENDIF
NEXT

$SHOW_LOOP

PRINTFORML 以调查特殊势力得到的知识为基础，研究特殊的技术
PRINTFORML 
PRINTFORML 现在的研究重点[ {RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属)} ]
PRINTFORML 需要100个研究点
CALL SINGLE_DRAWLINE

IF IS_RESEARCH_AGREEMENT_WITH_SP:(CFLAG:MASTER:所属) == 1
	PRINTBUTTON "[精子力发电]", 1
	PRINTL 
ENDIF
IF RESEARCH_UNIVERSITY_CAN_COMMUNICATE_SP:(CFLAG:MASTER:所属):4 == 1
	PRINTBUTTON "[触手・信号塔]", 2
	PRINTL
	PRINTBUTTON "[触手・戴森炮]", 3
	PRINTL
ENDIF

CALL SINGLE_DRAWLINE
PRINTL
IF 選択対象 == 1
	PRINTL 「精子力発電」
	PRINTL 说明:让具有特殊阴茎的对象自行发电
	PRINTL 　　将活塞运动和射精的动能转换为电力
	PRINTL 效果:从纪念品中提取国库资金和特殊资源“高浓度精力”
	IF RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):4 > 0
		PRINTL 研究完毕
	ELSEIF RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) < 100
		PRINTL 研究点不足
	ELSE
		PRINTBUTTON "[研究]", 101
		PRINTL 
	ENDIF
ELSEIF 選択対象 == 2
	PRINTL 「触手・信标」
	PRINTL 说明:放出诱导触手的特殊妖力波，让触手听从指令
	PRINTL 效果:触手势力成为自己势力的傀儡国
	PRINTL 　　从纪念品中提取特殊资源“触手能源”
	IF RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):5 > 0
		PRINTL 研究完毕
	ELSEIF RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) < 100
		PRINTL 研究点不足
	ELSE
		PRINTBUTTON "[研究]", 102
		PRINTL 
	ENDIF
ELSEIF 選択対象 == 3
	PRINTL 「触手・戴森炮」
	PRINTL 说明:将触手能量注入被戴森球包裹的触手块，使其迅速繁殖
	PRINTL 　　　利用这种反作用力，通过间隙向对象输送大量的触手
	PRINTL 效果:用触手凌辱选择的他国士官，使其不能行动2回合。消耗触手能量。
	IF RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):6 > 0
		PRINTL 研究完毕
	ELSEIF RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) < 100
		PRINTL 研究点不足
	ELSE
		PRINTBUTTON "[研究]", 103
		PRINTL 
	ENDIF
ENDIF
CALL SINGLE_DRAWLINE

PRINTL
PRINTBUTTON "99[取消]", 99
PRINTL 

$INPUT_LOOP
INPUT

IF RESULT == 99
	REDRAW 1
	RETURN

ELSEIF RESULT == 1 || RESULT == 2
	IF RESULT == 1
		選択対象 = 1
	ELSEIF RESULT == 2
		選択対象 = 2
	ELSEIF RESULT == 3
		選択対象 = 3
	ENDIF
	GOTO SHOW_LOOP

ELSEIF RESULT == 101 && 選択対象 == 1
	RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) -= 100
	RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):4 = 1
	PRINTL 「精子力发电」的研究在特殊区域建造
	PRINTW 「射精地獄」可以使用那些堕落的军官
ELSEIF RESULT == 102 && 選択対象 == 2
	RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) -= 100
	RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):5 = 1
	PRINTL 「触手・信标」的研究在特殊区域建造
	PRINTW 「触手地獄」可以使用那些堕落的军官
	PRINTL 
	PRINTFORML 利用触手・信号塔成功地控制了这些触手
	PRINTFORMW 触手势力成了我国的傀儡国
	CALL INIT_Pupet(外交対象, (CFLAG:MASTER:所属))
	IS_SP_COUNTRY_IN_UNION:連邦ナンバー:4 = 1
	PRINTL 
	PRINTFORMW 所有势力都对这一事态保持高度警惕。
	
	FOR LOCAL, 1, MAX_COUNTRY
		SIF !IS_COUNTRY(LOCAL) || LOCAL == CFLAG:MASTER:所属 || 連邦構成国:(LOCAL) == 1
			CONTINUE
		CALL CHANGE_RELATION_C_TO_C(LOCAL, CFLAG:MASTER:所属, -200, 300)
	NEXT
ELSEIF RESULT == 103 && 選択対象 == 3
	RESEARCH_UNIVERSITY_POINT:(CFLAG:MASTER:所属) -= 100
	RESEARCH_UNIVERSITY_CAN_KNOWLEDGE_SP:(CFLAG:MASTER:所属):6 = 1
	PRINTL 「触手・戴森炮」的研究在特殊区域建造
	PRINTW 可消耗「触手能源」来攻击敌方军官
ELSE
	CLEARLINE 1
	GOTO INPUT_LOOP
ENDIF
RESTART

